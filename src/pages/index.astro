---
import { getCollection } from "astro:content";
import Layout from "../layouts/main.astro";
import Header from "../components/header"; 
import Pomodoro from "../components/pomodoro"; 
import GithubActivity from "../components/github-activity"; 
import Stack from "../components/stack";
import ProjectList from "../components/micro/ProjectList";
import HeroSection from "../components/micro/HeroSection";
import BentoPosts from "../components/BentoPosts";

// SEO
const title = "Rishwanth Perumandla | Senior Backend Engineer";
const description = "Rishwanth Perumandla: Senior Backend Engineer & AI Infrastructure Architect.";

// Get posts from content collection
const allPosts = await getCollection("post");

function parseDate(dateStr: string) {
  const [month, day, year] = dateStr.split(" ");
  return new Date(`${month} ${parseInt(day)}, ${year}`);
}

const sortedPosts = allPosts
  .map((post) => ({ ...post, date: parseDate(post.data.dateFormatted) }))
  .sort((a, b) => b.date.getTime() - a.date.getTime());

// Take top 3 posts for display
const featuredPosts = sortedPosts.slice(0, 3);

// Projects Data
const projects = [
  {
    id: "01",
    name: "VoixAI",
    role: "AI Infrastructure",
    desc: "Voice ordering engine with <500ms latency using OpenAI Whisper.",
    link: "https://github.com/RishwanthPerumandla/VoixAI"
  },
  {
    id: "02",
    name: "Brekrr",
    role: "Distributed Systems",
    desc: "Microservices platform matching startups with top-tier talent.",
    link: "https://www.brekrr.com"
  },
  {
    id: "03",
    name: "Rivach Cloud",
    role: "Cloud Engineering",
    desc: "Optimized AWS architecture reducing monthly spend by 40%.",
    link: "#"
  }
];
---

<Layout title={title} description={description}>
  <Header client:load />

  <main class="relative z-10 w-full max-w-4xl mx-auto px-6 md:px-12 xl:px-0 pt-32 md:pt-36 pb-40">

    <HeroSection client:load />

    <section class="mb-24 p-8 bg-white/60 backdrop-blur-sm border border-neutral-200 rounded-xl relative overflow-hidden shadow-sm">
        
      <div class="absolute top-0 right-0 p-4 opacity-10">
          <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="text-neutral-900"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
      </div>
      
      <h3 class="font-mono text-xs uppercase tracking-widest text-neutral-500 mb-4">The Thing About Me</h3>
      
      <div class="prose prose-neutral max-w-none">
          <p class="text-lg leading-relaxed text-neutral-700">
              It is one thing to run a model in a notebook, but making it reliable for the real world is where the <strong>actual engineering</strong> happens.
          </p>
          <p class="text-lg leading-relaxed text-neutral-700 mt-4">
              My work focuses on the intersection of <strong>backend engineering</strong> and <strong>AI</strong>. I take pre-trained models and build the solid infrastructure they need to actually function at scale. I care about how the system handles pressure and how it serves the user. I build the kind of quiet, reliable systems that let teams focus on the future instead of fixing the past.
          </p>
          
          <div class="mt-8 pt-6 border-t border-dashed border-neutral-200">
              <a href="/about" class="group inline-flex items-center gap-2 text-sm font-medium text-neutral-900 hover:text-neutral-600 transition-colors">
                  <span class="border-b border-neutral-900 group-hover:border-neutral-600">Read my full journey & timeline</span>
                  <span class="group-hover:translate-x-1 transition-transform">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                    </svg>
                  </span>
              </a>
          </div>
      </div>
    </section>

    <Stack client:visible />

    <section id="work" class="mb-32">
        <div class="flex items-end justify-between mb-8">
            <h2 class="text-2xl font-bold text-neutral-900">Featured Projects</h2>
            <span class="font-mono text-xs text-neutral-400">SELECT_WORK_2026</span>
        </div>
        
        <ProjectList projects={projects} client:visible />

        <div class="mt-8 flex justify-center">
            <a href="/projects" class="inline-flex items-center gap-2 px-6 py-3 bg-neutral-900 text-white rounded-lg font-mono text-xs hover:bg-neutral-800 transition-colors">
                View All Projects
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                </svg>
            </a>
        </div>
    </section>

    <section class="mb-32">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-neutral-900">Commit History</h2>
            <span class="font-mono text-xs text-neutral-400">ACTIVE_CONTRIBUTOR</span>
        </div>
        <div class="w-full p-8 border border-neutral-200 rounded-xl bg-white/80 shadow-sm">
             <GithubActivity client:visible />
        </div>
    </section>

    <section class="mb-32">
        <div class="flex items-end justify-between mb-8">
            <h2 class="text-2xl font-bold text-neutral-900">Thoughts & Notes</h2>
            <span class="font-mono text-xs text-neutral-400">BRAIN_DUMP</span>
        </div>
        
        <BentoPosts posts={featuredPosts} client:visible />
        
        <div class="mt-8 flex justify-center">
            <a href="/posts" class="inline-flex items-center gap-2 px-6 py-3 bg-neutral-900 text-white rounded-lg font-mono text-xs hover:bg-neutral-800 transition-colors">
                Read All Posts
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                </svg>
            </a>
        </div>
    </section>  

    <section class="mb-40">
        <Pomodoro client:visible />
    </section>

  </main>
</Layout>
