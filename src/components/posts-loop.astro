---
import { getCollection } from "astro:content";
const allPosts = await getCollection("post");

const { count } = Astro.props;

function parseDate(dateStr) {
  const [month, day, year] = dateStr.split(" ");
  return new Date(`${month} ${parseInt(day)}, ${year}`);
}

function truncate(str = "", limit = 150) {
  if (!str) return "";
  if (str.length <= limit) return str;
  // cut on word boundary
  const sliced = str.slice(0, limit);
  return sliced.replace(/\s+\S*$/, "") + "â€¦";
}

const sortedPosts = allPosts
  .map((post) => ({ ...post, date: parseDate(post.data.dateFormatted) }))
  .sort((a, b) => b.date.getTime() - a.date.getTime());

const postsLoop = sortedPosts.slice(0, count).map((post) => {
  const data = post.data || {};
  const preview = data.description || "";
  return {
    ...data,
    preview: truncate(preview, 160), // adjust length here
    link: `/post/${post.slug}`,
  };
});
---

{postsLoop.map((post) => (
  <a
    href={post.link}
    class="relative block border border-transparent border-dashed p-7 group rounded-2xl focus:outline-none focus:ring-2 focus:ring-neutral-400 dark:focus:ring-neutral-600"
  >
    <div class="absolute inset-0 z-20 w-full h-full duration-300 ease-out bg-white border border-dashed dark:bg-neutral-950 rounded-2xl border-neutral-300 dark:border-neutral-600 group-hover:-translate-x-1 group-hover:-translate-y-1"></div>
    <div class="absolute inset-0 z-10 w-full h-full duration-300 ease-out border border-dashed rounded-2xl border-neutral-300 dark:border-neutral-600 group-hover:translate-x-1 group-hover:translate-y-1"></div>

    <div class="relative z-30 duration-300 ease-out group-hover:-translate-x-1 group-hover:-translate-y-1">
      <h2 class="mb-3 text-base sm:text-lg font-bold leading-tight tracking-tight dark:text-neutral-100">
        {post.title}
      </h2>

      <p class="no-math text-sm text-neutral-600 dark:text-neutral-400">
        {post.preview}
      </p>

      <div class="mt-2.5 text-xs font-medium text-neutral-800 dark:text-neutral-300">
        Posted on {post.dateFormatted}
      </div>
    </div>
  </a>
))}
